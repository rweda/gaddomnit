define(["bluebird"],function(t){"use strict";function e(t,e){return e={exports:{}},t(e,e.exports),e.exports}t="default"in t?t.default:t;var r,n,o="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},i=e(function(t,e){function r(t,e){return t.set(e[0],e[1]),t}function n(t,e){return t.add(e),t}function i(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function u(t,e){for(var r=-1,n=t?t.length:0;++r<n&&e(t[r],r,t)!==!1;);return t}function c(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}function a(t,e,r,n){var o=-1,i=t?t.length:0;for(n&&i&&(r=t[++o]);++o<i;)r=e(r,t[o],o,t);return r}function s(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}function l(t){return function(e){return t(e)}}function f(t,e){return null==t?void 0:t[e]}function p(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function h(t){var e=-1,r=Array(t.size);return t.forEach(function(t,n){r[++e]=[n,t]}),r}function y(t,e){return function(r){return t(e(r))}}function v(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}function d(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function _(){this.__data__=ir?ir(null):{}}function g(t){return this.has(t)&&delete this.__data__[t]}function b(t){var e=this.__data__;if(ir){var r=e[t];return r===Ut?void 0:r}return De.call(e,t)?e[t]:void 0}function m(t){var e=this.__data__;return ir?void 0!==e[t]:De.call(e,t)}function S(t,e){var r=this.__data__;return r[t]=ir&&void 0===e?Ut:e,this}function w(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function j(){this.__data__=[]}function A(t){var e=this.__data__,r=U(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():Ke.call(e,r,1),!0}function O(t){var e=this.__data__,r=U(e,t);return r<0?void 0:e[r][1]}function x(t){return U(this.__data__,t)>-1}function E(t,e){var r=this.__data__,n=U(r,t);return n<0?r.push([t,e]):r[n][1]=e,this}function C(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function T(){this.__data__={hash:new d,map:new(er||w),string:new d}}function H(t){return vt(this,t).delete(t)}function z(t){return vt(this,t).get(t)}function F(t){return vt(this,t).has(t)}function B(t,e){return vt(this,t).set(t,e),this}function N(t){this.__data__=new w(t)}function M(){this.__data__=new w}function L(t){return this.__data__.delete(t)}function P(t){return this.__data__.get(t)}function k(t){return this.__data__.has(t)}function D(t,e){var r=this.__data__;if(r instanceof w){var n=r.__data__;if(!er||n.length<Rt-1)return n.push([t,e]),this;r=this.__data__=new C(n)}return r.set(t,e),this}function $(t,e){var r=vr(t)||Tt(t)?s(t.length,String):[],n=r.length,o=!!n;for(var i in t)!e&&!De.call(t,i)||o&&("length"==i||mt(i,n))||r.push(i);return r}function I(t,e,r){(void 0===r||Ct(t[e],r))&&("number"!=typeof e||void 0!==r||e in t)||(t[e]=r)}function R(t,e,r){var n=t[e];De.call(t,e)&&Ct(n,r)&&(void 0!==r||e in t)||(t[e]=r)}function U(t,e){for(var r=t.length;r--;)if(Ct(t[r][0],e))return r;return-1}function V(t,e){return t&&ft(e,kt(e),t)}function W(t,e,r,n,o,i,c){var a;if(n&&(a=i?n(t,o,i,c):n(t)),void 0!==a)return a;if(!Nt(t))return t;var s=vr(t);if(s){if(a=_t(t),!e)return lt(t,a)}else{var l=yr(t),f=l==Qt||l==Xt;if(dr(t))return rt(t,e);if(l==te||l==Wt||f&&!i){if(p(t))return i?t:{};if(a=gt(f?{}:t),!e)return pt(t,V(a,t))}else{if(!je[l])return i?t:{};a=bt(t,l,W,e)}}c||(c=new N);var h=c.get(t);if(h)return h;if(c.set(t,a),!s)var y=r?yt(t):kt(t);return u(y||t,function(o,i){y&&(i=o,o=t[i]),R(a,i,W(o,e,r,n,i,t,c))}),a}function G(t){return Nt(t)?qe(t):{}}function q(t,e,r){var n=e(t);return vr(t)?n:c(n,r(t))}function J(t){return Ie.call(t)}function K(t){if(!Nt(t)||jt(t))return!1;var e=Ft(t)||p(t)?Re:me;return e.test(Et(t))}function Q(t){return Mt(t)&&Bt(t.length)&&!!we[Ie.call(t)]}function X(t){if(!At(t))return Ye(t);var e=[];for(var r in Object(t))De.call(t,r)&&"constructor"!=r&&e.push(r);return e}function Y(t){if(!Nt(t))return xt(t);var e=At(t),r=[];for(var n in t)("constructor"!=n||!e&&De.call(t,n))&&r.push(n);return r}function Z(t,e,r,n,o){if(t!==e){if(!vr(e)&&!_r(e))var i=Y(e);u(i||e,function(u,c){if(i&&(c=u,u=e[c]),Nt(u))o||(o=new N),tt(t,e,c,r,Z,n,o);else{var a=n?n(t[c],u,c+"",t,e,o):void 0;void 0===a&&(a=u),I(t,c,a)}})}}function tt(t,e,r,n,o,i,u){var c=t[r],a=e[r],s=u.get(a);if(s)return void I(t,r,s);var l=i?i(c,a,r+"",t,e,u):void 0,f=void 0===l;f&&(l=a,vr(a)||_r(a)?vr(c)?l=c:zt(c)?l=lt(c):(f=!1,l=W(a,!0)):Lt(a)||Tt(a)?Tt(c)?l=Pt(c):!Nt(c)||n&&Ft(c)?(f=!1,l=W(a,!0)):l=c:f=!1),f&&(u.set(a,l),o(l,a,n,i,u),u.delete(a)),I(t,r,l)}function et(t,e){return e=Ze(void 0===e?t.length-1:e,0),function(){for(var r=arguments,n=-1,o=Ze(r.length-e,0),u=Array(o);++n<o;)u[n]=r[e+n];n=-1;for(var c=Array(e+1);++n<e;)c[n]=r[n];return c[e]=u,i(t,this,c)}}function rt(t,e){if(e)return t.slice();var r=new t.constructor(t.length);return t.copy(r),r}function nt(t){var e=new t.constructor(t.byteLength);return new We(e).set(new We(t)),e}function ot(t,e){var r=e?nt(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}function it(t,e,n){var o=e?n(h(t),!0):h(t);return a(o,r,new t.constructor)}function ut(t){var e=new t.constructor(t.source,be.exec(t));return e.lastIndex=t.lastIndex,e}function ct(t,e,r){var o=e?r(v(t),!0):v(t);return a(o,n,new t.constructor)}function at(t){return pr?Object(pr.call(t)):{}}function st(t,e){var r=e?nt(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}function lt(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}function ft(t,e,r,n){r||(r={});for(var o=-1,i=e.length;++o<i;){var u=e[o],c=n?n(r[u],t[u],u,r,t):void 0;R(r,u,void 0===c?t[u]:c)}return r}function pt(t,e){return ft(t,hr(t),e)}function ht(t){return et(function(e,r){var n=-1,o=r.length,i=o>1?r[o-1]:void 0,u=o>2?r[2]:void 0;for(i=t.length>3&&"function"==typeof i?(o--,i):void 0,u&&St(r[0],r[1],u)&&(i=o<3?void 0:i,o=1),e=Object(e);++n<o;){var c=r[n];c&&t(e,c,n,i)}return e})}function yt(t){return q(t,kt,hr)}function vt(t,e){var r=t.__data__;return wt(e)?r["string"==typeof e?"string":"hash"]:r.map}function dt(t,e){var r=f(t,e);return K(r)?r:void 0}function _t(t){var e=t.length,r=t.constructor(e);return e&&"string"==typeof t[0]&&De.call(t,"index")&&(r.index=t.index,r.input=t.input),r}function gt(t){return"function"!=typeof t.constructor||At(t)?{}:G(Ge(t))}function bt(t,e,r,n){var o=t.constructor;switch(e){case ce:return nt(t);case qt:case Jt:return new o(+t);case ae:return ot(t,n);case se:case le:case fe:case pe:case he:case ye:case ve:case de:case _e:return st(t,n);case Yt:return it(t,n,r);case Zt:case oe:return new o(t);case re:return ut(t);case ne:return ct(t,n,r);case ie:return at(t)}}function mt(t,e){return e=null==e?Vt:e,!!e&&("number"==typeof t||Se.test(t))&&t>-1&&t%1==0&&t<e}function St(t,e,r){if(!Nt(r))return!1;var n=typeof e;return!!("number"==n?Ht(r)&&mt(e,r.length):"string"==n&&e in r)&&Ct(r[e],t)}function wt(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}function jt(t){return!!Pe&&Pe in t}function At(t){var e=t&&t.constructor,r="function"==typeof e&&e.prototype||Me;return t===r}function Ot(t,e,r,n,o,i){return Nt(t)&&Nt(e)&&(i.set(e,t),Z(t,e,void 0,Ot,i),i.delete(e)),t}function xt(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}function Et(t){if(null!=t){try{return ke.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Ct(t,e){return t===e||t!==t&&e!==e}function Tt(t){return zt(t)&&De.call(t,"callee")&&(!Je.call(t,"callee")||Ie.call(t)==Wt)}function Ht(t){return null!=t&&Bt(t.length)&&!Ft(t)}function zt(t){return Mt(t)&&Ht(t)}function Ft(t){var e=Nt(t)?Ie.call(t):"";return e==Qt||e==Xt}function Bt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Vt}function Nt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Mt(t){return!!t&&"object"==typeof t}function Lt(t){if(!Mt(t)||Ie.call(t)!=te||p(t))return!1;var e=Ge(t);if(null===e)return!0;var r=De.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&ke.call(r)==$e}function Pt(t){return ft(t,Dt(t))}function kt(t){return Ht(t)?$(t):X(t)}function Dt(t){return Ht(t)?$(t,!0):Y(t)}function $t(){return[]}function It(){return!1}var Rt=200,Ut="__lodash_hash_undefined__",Vt=9007199254740991,Wt="[object Arguments]",Gt="[object Array]",qt="[object Boolean]",Jt="[object Date]",Kt="[object Error]",Qt="[object Function]",Xt="[object GeneratorFunction]",Yt="[object Map]",Zt="[object Number]",te="[object Object]",ee="[object Promise]",re="[object RegExp]",ne="[object Set]",oe="[object String]",ie="[object Symbol]",ue="[object WeakMap]",ce="[object ArrayBuffer]",ae="[object DataView]",se="[object Float32Array]",le="[object Float64Array]",fe="[object Int8Array]",pe="[object Int16Array]",he="[object Int32Array]",ye="[object Uint8Array]",ve="[object Uint8ClampedArray]",de="[object Uint16Array]",_e="[object Uint32Array]",ge=/[\\^$.*+?()[\]{}|]/g,be=/\w*$/,me=/^\[object .+?Constructor\]$/,Se=/^(?:0|[1-9]\d*)$/,we={};we[se]=we[le]=we[fe]=we[pe]=we[he]=we[ye]=we[ve]=we[de]=we[_e]=!0,we[Wt]=we[Gt]=we[ce]=we[qt]=we[ae]=we[Jt]=we[Kt]=we[Qt]=we[Yt]=we[Zt]=we[te]=we[re]=we[ne]=we[oe]=we[ue]=!1;var je={};je[Wt]=je[Gt]=je[ce]=je[ae]=je[qt]=je[Jt]=je[se]=je[le]=je[fe]=je[pe]=je[he]=je[Yt]=je[Zt]=je[te]=je[re]=je[ne]=je[oe]=je[ie]=je[ye]=je[ve]=je[de]=je[_e]=!0,je[Kt]=je[Qt]=je[ue]=!1;var Ae="object"==typeof o&&o&&o.Object===Object&&o,Oe="object"==typeof self&&self&&self.Object===Object&&self,xe=Ae||Oe||Function("return this")(),Ee="object"==typeof e&&e&&!e.nodeType&&e,Ce=Ee&&"object"==typeof t&&t&&!t.nodeType&&t,Te=Ce&&Ce.exports===Ee,He=Te&&Ae.process,ze=function(){try{return He&&He.binding("util")}catch(t){}}(),Fe=ze&&ze.isTypedArray,Be=Array.prototype,Ne=Function.prototype,Me=Object.prototype,Le=xe["__core-js_shared__"],Pe=function(){var t=/[^.]+$/.exec(Le&&Le.keys&&Le.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),ke=Ne.toString,De=Me.hasOwnProperty,$e=ke.call(Object),Ie=Me.toString,Re=RegExp("^"+ke.call(De).replace(ge,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ue=Te?xe.Buffer:void 0,Ve=xe.Symbol,We=xe.Uint8Array,Ge=y(Object.getPrototypeOf,Object),qe=Object.create,Je=Me.propertyIsEnumerable,Ke=Be.splice,Qe=Object.getOwnPropertySymbols,Xe=Ue?Ue.isBuffer:void 0,Ye=y(Object.keys,Object),Ze=Math.max,tr=dt(xe,"DataView"),er=dt(xe,"Map"),rr=dt(xe,"Promise"),nr=dt(xe,"Set"),or=dt(xe,"WeakMap"),ir=dt(Object,"create"),ur=Et(tr),cr=Et(er),ar=Et(rr),sr=Et(nr),lr=Et(or),fr=Ve?Ve.prototype:void 0,pr=fr?fr.valueOf:void 0;d.prototype.clear=_,d.prototype.delete=g,d.prototype.get=b,d.prototype.has=m,d.prototype.set=S,w.prototype.clear=j,w.prototype.delete=A,w.prototype.get=O,w.prototype.has=x,w.prototype.set=E,C.prototype.clear=T,C.prototype.delete=H,C.prototype.get=z,C.prototype.has=F,C.prototype.set=B,N.prototype.clear=M,N.prototype.delete=L,N.prototype.get=P,N.prototype.has=k,N.prototype.set=D;var hr=Qe?y(Qe,Object):$t,yr=J;(tr&&yr(new tr(new ArrayBuffer(1)))!=ae||er&&yr(new er)!=Yt||rr&&yr(rr.resolve())!=ee||nr&&yr(new nr)!=ne||or&&yr(new or)!=ue)&&(yr=function(t){var e=Ie.call(t),r=e==te?t.constructor:void 0,n=r?Et(r):void 0;if(n)switch(n){case ur:return ae;case cr:return Yt;case ar:return ee;case sr:return ne;case lr:return ue}return e});var vr=Array.isArray,dr=Xe||It,_r=Fe?l(Fe):Q,gr=et(function(t){return t.push(void 0,Ot),i(br,void 0,t)}),br=ht(function(t,e,r,n){Z(t,e,r,n)});t.exports=gr});n=t,r=function(){function t(){}return t.stored={},t.get=function(t){return this.stored[t]?this.stored[t]:this.stored=this.getNoCache(t)},t.getNoCache=function(t){return new n(function(e,r){var n,o,i,u,c,a,s,l,f,p;for(c=document.createElement("iframe"),document.body.appendChild(c),i=null!=(f=c.contentDocument)?f:c.contentWindow.document,o=i.createElement(t),i.body.appendChild(o),p={},n=o.ownerDocument.defaultView.getComputedStyle(o),u=a=0,s=n.length;a<s;u=++a)l=n[u],p[u]=l,p[l]=n[l];return p.cssText=n.cssText,document.body.removeChild(c),e(p)})},t}();var u,c,a,s=r,l=function(t,e){return function(){return t.apply(e,arguments)}},f=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};u=s,a=t,c=function(){function t(t,e,r,n){this.el=t,this.children=e,this.opt=r,this.isRoot=n,this.saveStyle=l(this.saveStyle,this),this.originalElement=this.el,this.el=this.el.cloneNode(!1)}return t.prototype.saveStyle=function(){if(this.el.hasAttribute("style"))return this.el.setAttribute(this.opt.originalStyle,this.el.getAttribute("style"))},t.prototype.defaultStyleFilter=function(){return this.opt.useBrowserStyle?u.get(this.el.tagName).then(function(t){return function(t){return a.resolve(function(e,r){return e[r]===t[r]})}}(this)):a.resolve(function(){return!1})},t.prototype.inheritFilter=function(){var t;return!this.opt.inheritStyle||this.isRoot?function(){return!1}:(t=getComputedStyle(this.originalElement.parentElement),function(e){return function(r,n){return(e.opt.inheritStyle===!0||f.call(e.opt.inheritStyle,n)>=0)&&(r[n]===t[n]&&(!(e.opt.inheritSilent&&f.call(e.opt.inheritSilent,n)>=0)||"silent"))}}(this))},t.prototype.serializeStyle=function(){var t,e,r;return(null!=(e=this.opt.style)?e[this.el.tagName.toLowerCase()]:void 0)===!1?(this.el.removeAttribute("style"),a.resolve()):this.el.currentStyle?this.el.setAttribute("style",this.originalElement.currentStyle):this.opt.useBrowserStyle||this.opt.inheritStyle?(r=getComputedStyle(this.originalElement),t=this.inheritFilter(),this.defaultStyleFilter().then(function(e){return function(n){var o,i,u,c,a;for(a=[],i=0,u=r.length;i<u;i++)c=r[i],o=t(r,c),n(r,c)||"silent"===o||a.push(e.el.style[c]=o?"inherit":r[c]);return a}}(this))):this.el.style.cssText=getComputedStyle(this.originalElement).cssText},t.prototype.update=function(){return this.saveStyle(),this.serializeStyle()},t.prototype.interweaveText=function(){var t,e,r,n,o,i,u,c,a,s,l;if(e=this.originalElement.textContent,!e)return this.children;for(s=[[],0],n=s[0],i=s[1],l=this.originalElement.children,r=o=0,u=l.length;o<u;r=++o)t=l[r],c=t.textContent,c?(a=e.indexOf(c,i),a>0&&(n.push(e.substring(i,a)),i=a),n.push(this.children[r]),i+=c.length):n.push(this.children[r]);return n.push(e.substring(i)),n},t.prototype.toString=function(){return a.resolve(this.update()).then(function(t){return function(){var e,r;return r=t.el.tagName,e=[r],t.el.innerHTML=t.interweaveText().join(""),t.el.outerHTML}}(this))},t}();var p,h,y=c,v=function(t,e){function r(){this.constructor=t}for(var n in e)d.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},d={}.hasOwnProperty;p=y,h=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return v(e,t),e.prototype.moveSrc=function(){if(this.el.hasAttribute("src"))return this.el.setAttribute(this.opt.originalSrc,this.el.getAttribute("src")),this.el.removeAttribute("src")},e.prototype.removeBody=function(){return this.el.innerHTML=""},e.prototype.toString=function(){return e.__super__.toString.call(this).then(function(t){return function(){return t.moveSrc(),t.removeBody(),t.el.outerHTML}}(this))},e}(p);var _,g,b=h,m=function(t,e){function r(){this.constructor=t}for(var n in e)S.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},S={}.hasOwnProperty;_=y,g=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return m(e,t),e.prototype.moveHref=function(){if(this.el.hasAttribute("href"))return this.el.setAttribute(this.opt.linkHref,this.el.getAttribute("href")),this.el.removeAttribute("href")},e.prototype.update=function(){return e.__super__.update.call(this).then(function(t){return function(){return t.moveHref()}}(this))},e}(_);var w,j,A=g,O=function(t,e){function r(){this.constructor=t}for(var n in e)x.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},x={}.hasOwnProperty;w=y,j=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return O(e,t),e.prototype.removeBody=function(){return this.el.innerHTML=""},e.prototype.toString=function(){return e.__super__.toString.call(this).then(function(t){return function(){return t.removeBody(),t.el.outerHTML}}(this))},e}(w);var E,C,T,H,z,F,B,N=j;B=i,H=t,C=y,z=b,T=A,F=N,E=function(){function t(t){this.opt=null!=t?t:{},B(this.opt,{originalStyle:"data-originalStyle",originalSrc:"data-originalSrc",linkHref:"data-originalHref",useBrowserStyle:!0,style:{head:!1,title:!1,link:!1,meta:!1,style:!1,script:!1},filter:null,filterHidden:!1,filterDisplayNone:!1,inheritStyle:!0,inheritSilent:["font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","visibility"]})}return t.ElementSerializer=C,t.prototype.elementSerializer=C,t.prototype.scriptSerializer=z,t.prototype.linkSerializer=T,t.prototype.styleSerializer=F,t.prototype.passFilter=function(t){return!this.opt.filter||this.opt.filter(t)},t.prototype.passFilterHidden=function(t){return!this.opt.filterHidden||"hidden"!==getComputedStyle(t).visibility},t.prototype.passDisplayNone=function(t){return!this.opt.filterDisplayNone||"none"!==getComputedStyle(t).display},t.prototype.serialize=function(t,e){var r,n,o,i,u,c,a,s;if(null==e&&(e=!0),!(this.passFilter(t)&&this.passFilterHidden(t)&&this.passDisplayNone(t)))return"";for(i=t.tagName.toLowerCase()+"Serializer",r=null!=(a=this[i])?a:this.elementSerializer,o=[],s=t.children,u=0,c=s.length;u<c;u++)n=s[u],o.push(this.serialize(n,!1));return H.all(o).then(function(n){return function(o){var i;return i=new r(t,o,n.opt,e),i.toString()}}(this))},t}();var M=E;return M});
