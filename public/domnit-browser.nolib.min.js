define(["bluebird"],function(t){"use strict";function r(t,r){return r={exports:{}},t(r,r.exports),r.exports}t="default"in t?t.default:t;var e,n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},o=r(function(t,r){function e(t,r){return t.set(r[0],r[1]),t}function o(t,r){return t.add(r),t}function i(t,r,e){switch(e.length){case 0:return t.call(r);case 1:return t.call(r,e[0]);case 2:return t.call(r,e[0],e[1]);case 3:return t.call(r,e[0],e[1],e[2])}return t.apply(r,e)}function u(t,r){for(var e=-1,n=t?t.length:0;++e<n&&r(t[e],e,t)!==!1;);return t}function c(t,r){for(var e=-1,n=r.length,o=t.length;++e<n;)t[o+e]=r[e];return t}function a(t,r,e,n){var o=-1,i=t?t.length:0;for(n&&i&&(e=t[++o]);++o<i;)e=r(e,t[o],o,t);return e}function s(t,r){for(var e=-1,n=Array(t);++e<t;)n[e]=r(e);return n}function f(t){return function(r){return t(r)}}function l(t,r){return null==t?void 0:t[r]}function p(t){var r=!1;if(null!=t&&"function"!=typeof t.toString)try{r=!!(t+"")}catch(t){}return r}function h(t){var r=-1,e=Array(t.size);return t.forEach(function(t,n){e[++r]=[n,t]}),e}function y(t,r){return function(e){return t(r(e))}}function v(t){var r=-1,e=Array(t.size);return t.forEach(function(t){e[++r]=t}),e}function _(t){var r=-1,e=t?t.length:0;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}function d(){this.__data__=ie?ie(null):{}}function b(t){return this.has(t)&&delete this.__data__[t]}function g(t){var r=this.__data__;if(ie){var e=r[t];return e===Rt?void 0:e}return Fr.call(r,t)?r[t]:void 0}function j(t){var r=this.__data__;return ie?void 0!==r[t]:Fr.call(r,t)}function w(t,r){var e=this.__data__;return e[t]=ie&&void 0===r?Rt:r,this}function S(t){var r=-1,e=t?t.length:0;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}function A(){this.__data__=[]}function m(t){var r=this.__data__,e=R(r,t);if(e<0)return!1;var n=r.length-1;return e==n?r.pop():Kr.call(r,e,1),!0}function O(t){var r=this.__data__,e=R(r,t);return e<0?void 0:r[e][1]}function x(t){return R(this.__data__,t)>-1}function z(t,r){var e=this.__data__,n=R(e,t);return n<0?e.push([t,r]):e[n][1]=r,this}function E(t){var r=-1,e=t?t.length:0;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}function T(){this.__data__={hash:new _,map:new(re||S),string:new _}}function H(t){return vt(this,t).delete(t)}function M(t){return vt(this,t).get(t)}function P(t){return vt(this,t).has(t)}function k(t,r){return vt(this,t).set(t,r),this}function $(t){this.__data__=new S(t)}function B(){this.__data__=new S}function I(t){return this.__data__.delete(t)}function L(t){return this.__data__.get(t)}function C(t){return this.__data__.has(t)}function F(t,r){var e=this.__data__;if(e instanceof S){var n=e.__data__;if(!re||n.length<Dt-1)return n.push([t,r]),this;e=this.__data__=new E(n)}return e.set(t,r),this}function U(t,r){var e=ve(t)||Tt(t)?s(t.length,String):[],n=e.length,o=!!n;for(var i in t)!r&&!Fr.call(t,i)||o&&("length"==i||jt(i,n))||e.push(i);return e}function N(t,r,e){(void 0===e||Et(t[r],e))&&("number"!=typeof r||void 0!==e||r in t)||(t[r]=e)}function D(t,r,e){var n=t[r];Fr.call(t,r)&&Et(n,e)&&(void 0!==e||r in t)||(t[r]=e)}function R(t,r){for(var e=t.length;e--;)if(Et(t[e][0],r))return e;return-1}function V(t,r){return t&&lt(r,Ct(r),t)}function W(t,r,e,n,o,i,c){var a;if(n&&(a=i?n(t,o,i,c):n(t)),void 0!==a)return a;if(!$t(t))return t;var s=ve(t);if(s){if(a=dt(t),!r)return ft(t,a)}else{var f=ye(t),l=f==Qt||f==Xt;if(_e(t))return et(t,r);if(f==tr||f==Wt||l&&!i){if(p(t))return i?t:{};if(a=bt(l?{}:t),!r)return pt(t,V(a,t))}else{if(!Ar[f])return i?t:{};a=gt(t,f,W,r)}}c||(c=new $);var h=c.get(t);if(h)return h;if(c.set(t,a),!s)var y=e?yt(t):Ct(t);return u(y||t,function(o,i){y&&(i=o,o=t[i]),D(a,i,W(o,r,e,n,i,t,c))}),a}function G(t){return $t(t)?qr(t):{}}function q(t,r,e){var n=r(t);return ve(t)?n:c(n,e(t))}function J(t){return Nr.call(t)}function K(t){if(!$t(t)||At(t))return!1;var r=Pt(t)||p(t)?Dr:jr;return r.test(zt(t))}function Q(t){return Bt(t)&&kt(t.length)&&!!Sr[Nr.call(t)]}function X(t){if(!mt(t))return Yr(t);var r=[];for(var e in Object(t))Fr.call(t,e)&&"constructor"!=e&&r.push(e);return r}function Y(t){if(!$t(t))return xt(t);var r=mt(t),e=[];for(var n in t)("constructor"!=n||!r&&Fr.call(t,n))&&e.push(n);return e}function Z(t,r,e,n,o){if(t!==r){if(!ve(r)&&!de(r))var i=Y(r);u(i||r,function(u,c){if(i&&(c=u,u=r[c]),$t(u))o||(o=new $),tt(t,r,c,e,Z,n,o);else{var a=n?n(t[c],u,c+"",t,r,o):void 0;void 0===a&&(a=u),N(t,c,a)}})}}function tt(t,r,e,n,o,i,u){var c=t[e],a=r[e],s=u.get(a);if(s)return void N(t,e,s);var f=i?i(c,a,e+"",t,r,u):void 0,l=void 0===f;l&&(f=a,ve(a)||de(a)?ve(c)?f=c:Mt(c)?f=ft(c):(l=!1,f=W(a,!0)):It(a)||Tt(a)?Tt(c)?f=Lt(c):!$t(c)||n&&Pt(c)?(l=!1,f=W(a,!0)):f=c:l=!1),l&&(u.set(a,f),o(f,a,n,i,u),u.delete(a)),N(t,e,f)}function rt(t,r){return r=Zr(void 0===r?t.length-1:r,0),function(){for(var e=arguments,n=-1,o=Zr(e.length-r,0),u=Array(o);++n<o;)u[n]=e[r+n];n=-1;for(var c=Array(r+1);++n<r;)c[n]=e[n];return c[r]=u,i(t,this,c)}}function et(t,r){if(r)return t.slice();var e=new t.constructor(t.length);return t.copy(e),e}function nt(t){var r=new t.constructor(t.byteLength);return new Wr(r).set(new Wr(t)),r}function ot(t,r){var e=r?nt(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.byteLength)}function it(t,r,n){var o=r?n(h(t),!0):h(t);return a(o,e,new t.constructor)}function ut(t){var r=new t.constructor(t.source,gr.exec(t));return r.lastIndex=t.lastIndex,r}function ct(t,r,e){var n=r?e(v(t),!0):v(t);return a(n,o,new t.constructor)}function at(t){return pe?Object(pe.call(t)):{}}function st(t,r){var e=r?nt(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.length)}function ft(t,r){var e=-1,n=t.length;for(r||(r=Array(n));++e<n;)r[e]=t[e];return r}function lt(t,r,e,n){e||(e={});for(var o=-1,i=r.length;++o<i;){var u=r[o],c=n?n(e[u],t[u],u,e,t):void 0;D(e,u,void 0===c?t[u]:c)}return e}function pt(t,r){return lt(t,he(t),r)}function ht(t){return rt(function(r,e){var n=-1,o=e.length,i=o>1?e[o-1]:void 0,u=o>2?e[2]:void 0;for(i=t.length>3&&"function"==typeof i?(o--,i):void 0,u&&wt(e[0],e[1],u)&&(i=o<3?void 0:i,o=1),r=Object(r);++n<o;){var c=e[n];c&&t(r,c,n,i)}return r})}function yt(t){return q(t,Ct,he)}function vt(t,r){var e=t.__data__;return St(r)?e["string"==typeof r?"string":"hash"]:e.map}function _t(t,r){var e=l(t,r);return K(e)?e:void 0}function dt(t){var r=t.length,e=t.constructor(r);return r&&"string"==typeof t[0]&&Fr.call(t,"index")&&(e.index=t.index,e.input=t.input),e}function bt(t){return"function"!=typeof t.constructor||mt(t)?{}:G(Gr(t))}function gt(t,r,e,n){var o=t.constructor;switch(r){case cr:return nt(t);case qt:case Jt:return new o(+t);case ar:return ot(t,n);case sr:case fr:case lr:case pr:case hr:case yr:case vr:case _r:case dr:return st(t,n);case Yt:return it(t,n,e);case Zt:case or:return new o(t);case er:return ut(t);case nr:return ct(t,n,e);case ir:return at(t)}}function jt(t,r){return r=null==r?Vt:r,!!r&&("number"==typeof t||wr.test(t))&&t>-1&&t%1==0&&t<r}function wt(t,r,e){if(!$t(e))return!1;var n=typeof r;return!!("number"==n?Ht(e)&&jt(r,e.length):"string"==n&&r in e)&&Et(e[r],t)}function St(t){var r=typeof t;return"string"==r||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t}function At(t){return!!Lr&&Lr in t}function mt(t){var r=t&&t.constructor,e="function"==typeof r&&r.prototype||Br;return t===e}function Ot(t,r,e,n,o,i){return $t(t)&&$t(r)&&(i.set(r,t),Z(t,r,void 0,Ot,i),i.delete(r)),t}function xt(t){var r=[];if(null!=t)for(var e in Object(t))r.push(e);return r}function zt(t){if(null!=t){try{return Cr.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Et(t,r){return t===r||t!==t&&r!==r}function Tt(t){return Mt(t)&&Fr.call(t,"callee")&&(!Jr.call(t,"callee")||Nr.call(t)==Wt)}function Ht(t){return null!=t&&kt(t.length)&&!Pt(t)}function Mt(t){return Bt(t)&&Ht(t)}function Pt(t){var r=$t(t)?Nr.call(t):"";return r==Qt||r==Xt}function kt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Vt}function $t(t){var r=typeof t;return!!t&&("object"==r||"function"==r)}function Bt(t){return!!t&&"object"==typeof t}function It(t){if(!Bt(t)||Nr.call(t)!=tr||p(t))return!1;var r=Gr(t);if(null===r)return!0;var e=Fr.call(r,"constructor")&&r.constructor;return"function"==typeof e&&e instanceof e&&Cr.call(e)==Ur}function Lt(t){return lt(t,Ft(t))}function Ct(t){return Ht(t)?U(t):X(t)}function Ft(t){return Ht(t)?U(t,!0):Y(t)}function Ut(){return[]}function Nt(){return!1}var Dt=200,Rt="__lodash_hash_undefined__",Vt=9007199254740991,Wt="[object Arguments]",Gt="[object Array]",qt="[object Boolean]",Jt="[object Date]",Kt="[object Error]",Qt="[object Function]",Xt="[object GeneratorFunction]",Yt="[object Map]",Zt="[object Number]",tr="[object Object]",rr="[object Promise]",er="[object RegExp]",nr="[object Set]",or="[object String]",ir="[object Symbol]",ur="[object WeakMap]",cr="[object ArrayBuffer]",ar="[object DataView]",sr="[object Float32Array]",fr="[object Float64Array]",lr="[object Int8Array]",pr="[object Int16Array]",hr="[object Int32Array]",yr="[object Uint8Array]",vr="[object Uint8ClampedArray]",_r="[object Uint16Array]",dr="[object Uint32Array]",br=/[\\^$.*+?()[\]{}|]/g,gr=/\w*$/,jr=/^\[object .+?Constructor\]$/,wr=/^(?:0|[1-9]\d*)$/,Sr={};Sr[sr]=Sr[fr]=Sr[lr]=Sr[pr]=Sr[hr]=Sr[yr]=Sr[vr]=Sr[_r]=Sr[dr]=!0,Sr[Wt]=Sr[Gt]=Sr[cr]=Sr[qt]=Sr[ar]=Sr[Jt]=Sr[Kt]=Sr[Qt]=Sr[Yt]=Sr[Zt]=Sr[tr]=Sr[er]=Sr[nr]=Sr[or]=Sr[ur]=!1;var Ar={};Ar[Wt]=Ar[Gt]=Ar[cr]=Ar[ar]=Ar[qt]=Ar[Jt]=Ar[sr]=Ar[fr]=Ar[lr]=Ar[pr]=Ar[hr]=Ar[Yt]=Ar[Zt]=Ar[tr]=Ar[er]=Ar[nr]=Ar[or]=Ar[ir]=Ar[yr]=Ar[vr]=Ar[_r]=Ar[dr]=!0,Ar[Kt]=Ar[Qt]=Ar[ur]=!1;var mr="object"==typeof n&&n&&n.Object===Object&&n,Or="object"==typeof self&&self&&self.Object===Object&&self,xr=mr||Or||Function("return this")(),zr="object"==typeof r&&r&&!r.nodeType&&r,Er=zr&&"object"==typeof t&&t&&!t.nodeType&&t,Tr=Er&&Er.exports===zr,Hr=Tr&&mr.process,Mr=function(){try{return Hr&&Hr.binding("util")}catch(t){}}(),Pr=Mr&&Mr.isTypedArray,kr=Array.prototype,$r=Function.prototype,Br=Object.prototype,Ir=xr["__core-js_shared__"],Lr=function(){var t=/[^.]+$/.exec(Ir&&Ir.keys&&Ir.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Cr=$r.toString,Fr=Br.hasOwnProperty,Ur=Cr.call(Object),Nr=Br.toString,Dr=RegExp("^"+Cr.call(Fr).replace(br,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Rr=Tr?xr.Buffer:void 0,Vr=xr.Symbol,Wr=xr.Uint8Array,Gr=y(Object.getPrototypeOf,Object),qr=Object.create,Jr=Br.propertyIsEnumerable,Kr=kr.splice,Qr=Object.getOwnPropertySymbols,Xr=Rr?Rr.isBuffer:void 0,Yr=y(Object.keys,Object),Zr=Math.max,te=_t(xr,"DataView"),re=_t(xr,"Map"),ee=_t(xr,"Promise"),ne=_t(xr,"Set"),oe=_t(xr,"WeakMap"),ie=_t(Object,"create"),ue=zt(te),ce=zt(re),ae=zt(ee),se=zt(ne),fe=zt(oe),le=Vr?Vr.prototype:void 0,pe=le?le.valueOf:void 0;_.prototype.clear=d,_.prototype.delete=b,_.prototype.get=g,_.prototype.has=j,_.prototype.set=w,S.prototype.clear=A,S.prototype.delete=m,S.prototype.get=O,S.prototype.has=x,S.prototype.set=z,E.prototype.clear=T,E.prototype.delete=H,E.prototype.get=M,E.prototype.has=P,E.prototype.set=k,$.prototype.clear=B,$.prototype.delete=I,$.prototype.get=L,$.prototype.has=C,$.prototype.set=F;var he=Qr?y(Qr,Object):Ut,ye=J;(te&&ye(new te(new ArrayBuffer(1)))!=ar||re&&ye(new re)!=Yt||ee&&ye(ee.resolve())!=rr||ne&&ye(new ne)!=nr||oe&&ye(new oe)!=ur)&&(ye=function(t){var r=Nr.call(t),e=r==tr?t.constructor:void 0,n=e?zt(e):void 0;if(n)switch(n){case ue:return ar;case ce:return Yt;case ae:return rr;case se:return nr;case fe:return ur}return r});var ve=Array.isArray,_e=Xr||Nt,de=Pr?f(Pr):Q,be=rt(function(t){return t.push(void 0,Ot),i(ge,void 0,t)}),ge=ht(function(t,r,e,n){Z(t,r,e,n)});t.exports=be}),i=function(t,r){return function(){return t.apply(r,arguments)}};e=function(){function t(t,r,e){this.el=t,this.children=r,this.opt=e,this.saveStyle=i(this.saveStyle,this),this.originalElement=this.el,this.el=this.el.cloneNode(!1)}return t.prototype.saveStyle=function(){if(this.el.hasAttribute("style"))return this.el.setAttribute(this.opt.originalStyle,this.el.getAttribute("style"))},t.prototype.serializeStyle=function(){var t,r,e,n,o;if(this.el.currentStyle)return this.el.setAttribute("style",this.el.currentStyle);for(o=getComputedStyle(this.el),n=[],t=0,r=o.length;t<r;t++)e=o[t],n.push(this.el.style[e]=o[e]);return n},t.prototype.update=function(){return this.saveStyle(),this.serializeStyle()},t.prototype.interweaveText=function(){var t,r,e,n,o,i,u,c,a,s,f;if(r=this.originalElement.textContent,!r)return this.children;for(s=[[],0],n=s[0],i=s[1],f=this.originalElement.children,e=o=0,u=f.length;o<u;e=++o)t=f[e],c=t.textContent,c&&(a=r.indexOf(c,i),a>0&&(n.push(r.substring(i,a)),i=a),n.push(this.children[e]),i+=c.length);return n.push(r.substring(i)),n},t.prototype.toString=function(){var t,r;return this.update(),r=this.el.tagName,t=[r],this.el.innerHTML=this.interweaveText().join(""),this.el.outerHTML},t}();var u,c,a=e,s=function(t,r){function e(){this.constructor=t}for(var n in r)f.call(r,n)&&(t[n]=r[n]);return e.prototype=r.prototype,t.prototype=new e,t.__super__=r.prototype,t},f={}.hasOwnProperty;u=a,c=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return s(r,t),r.prototype.moveSrc=function(){if(this.el.hasAttribute("src"))return this.el.setAttribute(this.opt.originalSrc,this.el.getAttribute("src")),this.el.removeAttribute("src")},r.prototype.removeBody=function(){return this.el.innerHTML=""},r.prototype.toString=function(){return r.__super__.toString.call(this),this.moveSrc(),this.removeBody(),this.el.outerHTML},r}(u);var l,p,h=c,y=function(t,r){function e(){this.constructor=t}for(var n in r)v.call(r,n)&&(t[n]=r[n]);return e.prototype=r.prototype,t.prototype=new e,t.__super__=r.prototype,t},v={}.hasOwnProperty;l=a,p=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return y(r,t),r.prototype.moveHref=function(){if(this.el.hasAttribute("href"))return this.el.setAttribute(this.opt.linkHref,this.el.getAttribute("href")),this.el.removeAttribute("href")},r.prototype.update=function(){return r.__super__.update.call(this),this.moveHref()},r}(l);var _,d,b,g,j,w,S=p;w=o,g=t,d=a,j=h,b=S,_=function(){function t(t){this.opt=null!=t?t:{},w(this.opt,{originalStyle:"data-originalStyle",originalSrc:"data-originalSrc",linkHref:"data-originalHref"})}return t.prototype.elementSerializer=d,t.prototype.scriptSerializer=j,t.prototype.linkSerializer=b,t.prototype.serialize=function(t){var r,e,n,o,i,u,c,a;for(o=t.tagName.toLowerCase()+"Serializer",r=null!=(c=this[o])?c:this.elementSerializer,n=[],a=t.children,i=0,u=a.length;i<u;i++)e=a[i],n.push(this.serialize(e));return g.all(n).then(function(e){return function(n){var o;return o=new r(t,n,e.opt),o.toString()}}(this))},t}();var A=_;return A});
