"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var bluebird=_interopDefault(require("bluebird")),ElementSerializer$1,bind=function(e,t){return function(){return e.apply(t,arguments)}};ElementSerializer$1=function(){function e(e,t,i){this.el=e,this.children=t,this.opt=i,this.saveStyle=bind(this.saveStyle,this),this.originalElement=this.el,this.el=this.el.cloneNode(!1)}return e.prototype.saveStyle=function(){if(this.el.hasAttribute("style"))return this.el.setAttribute(this.opt.originalStyle,this.el.getAttribute("style"))},e.prototype.serializeStyle=function(){var e,t,i,r,n;if(this.el.currentStyle)return this.el.setAttribute("style",this.el.currentStyle);for(n=getComputedStyle(this.el),r=[],e=0,t=n.length;e<t;e++)i=n[e],r.push(this.el.style[i]=n[i]);return r},e.prototype.update=function(){return this.saveStyle(),this.serializeStyle()},e.prototype.interweaveText=function(){var e,t,i,r,n,l,s,o,u,h,a;if(t=this.originalElement.textContent,!t)return this.children;for(h=[[],0],r=h[0],l=h[1],a=this.originalElement.children,i=n=0,s=a.length;n<s;i=++n)e=a[i],o=e.textContent,o&&(u=t.indexOf(o,l),u>0&&(r.push(t.substring(l,u)),l=u),r.push(this.children[i]),l+=o.length);return r.push(t.substring(l)),r},e.prototype.toString=function(){var e,t;return this.update(),t=this.el.tagName,e=[t],this.el.innerHTML=this.interweaveText().join(""),this.el.outerHTML},e}();var ElementSerializer_1=ElementSerializer$1,Domnit,ElementSerializer,Promise;Promise=bluebird,ElementSerializer=ElementSerializer_1,Domnit=function(){function e(e){this.opt=e}return e.prototype.elementSerializer=ElementSerializer,e.prototype.serialize=function(e){var t,i,r,n,l,s,o,u;for(n=e.tagName+"Serializer",t=null!=(o=this[n])?o:this.elementSerializer,r=[],u=e.children,l=0,s=u.length;l<s;l++)i=u[l],r.push(this.serialize(i));return Promise.all(r).then(function(i){return function(r){var n;return n=new t(e,r,i.opt),n.toString()}}(this))},e}();var Domnit_1=Domnit;module.exports=Domnit_1;
