!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("bluebird")):"function"==typeof define&&define.amd?define(["bluebird"],e):t.Domnit=e(t.P)}(this,function(t){"use strict";function e(t,e){return e={exports:{}},t(e,e.exports),e.exports}t="default"in t?t.default:t;var r,n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},o=e(function(t,e){function r(t,e){return t.set(e[0],e[1]),t}function o(t,e){return t.add(e),t}function i(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function u(t,e){for(var r=-1,n=t?t.length:0;++r<n&&e(t[r],r,t)!==!1;);return t}function c(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}function a(t,e,r,n){var o=-1,i=t?t.length:0;for(n&&i&&(r=t[++o]);++o<i;)r=e(r,t[o],o,t);return r}function f(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}function s(t){return function(e){return t(e)}}function l(t,e){return null==t?void 0:t[e]}function h(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function p(t){var e=-1,r=Array(t.size);return t.forEach(function(t,n){r[++e]=[n,t]}),r}function v(t,e){return function(r){return t(e(r))}}function y(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}function d(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function _(){this.__data__=ir?ir(null):{}}function b(t){return this.has(t)&&delete this.__data__[t]}function g(t){var e=this.__data__;if(ir){var r=e[t];return r===Ht?void 0:r}return De.call(e,t)?e[t]:void 0}function j(t){var e=this.__data__;return ir?void 0!==e[t]:De.call(e,t)}function w(t,e){var r=this.__data__;return r[t]=ir&&void 0===e?Ht:e,this}function m(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function S(){this.__data__=[]}function O(t){var e=this.__data__,r=H(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():Ke.call(e,r,1),!0}function A(t){var e=this.__data__,r=H(e,t);return r<0?void 0:e[r][1]}function x(t){return H(this.__data__,t)>-1}function E(t,e){var r=this.__data__,n=H(r,t);return n<0?r.push([t,e]):r[n][1]=e,this}function z(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function P(){this.__data__={hash:new d,map:new(er||m),string:new d}}function T(t){return yt(this,t).delete(t)}function $(t){return yt(this,t).get(t)}function I(t){return yt(this,t).has(t)}function M(t,e){return yt(this,t).set(t,e),this}function F(t){this.__data__=new m(t)}function k(){this.__data__=new m}function B(t){return this.__data__.delete(t)}function C(t){return this.__data__.get(t)}function U(t){return this.__data__.has(t)}function D(t,e){var r=this.__data__;if(r instanceof m){var n=r.__data__;if(!er||n.length<Rt-1)return n.push([t,e]),this;r=this.__data__=new z(n)}return r.set(t,e),this}function L(t,e){var r=yr(t)||Pt(t)?f(t.length,String):[],n=r.length,o=!!n;for(var i in t)!e&&!De.call(t,i)||o&&("length"==i||jt(i,n))||r.push(i);return r}function N(t,e,r){(void 0===r||zt(t[e],r))&&("number"!=typeof e||void 0!==r||e in t)||(t[e]=r)}function R(t,e,r){var n=t[e];De.call(t,e)&&zt(n,r)&&(void 0!==r||e in t)||(t[e]=r)}function H(t,e){for(var r=t.length;r--;)if(zt(t[r][0],e))return r;return-1}function V(t,e){return t&&lt(e,Ut(e),t)}function W(t,e,r,n,o,i,c){var a;if(n&&(a=i?n(t,o,i,c):n(t)),void 0!==a)return a;if(!Ft(t))return t;var f=yr(t);if(f){if(a=_t(t),!e)return st(t,a)}else{var s=vr(t),l=s==Qt||s==Xt;if(dr(t))return rt(t,e);if(s==te||s==Wt||l&&!i){if(h(t))return i?t:{};if(a=bt(l?{}:t),!e)return ht(t,V(a,t))}else{if(!Se[s])return i?t:{};a=gt(t,s,W,e)}}c||(c=new F);var p=c.get(t);if(p)return p;if(c.set(t,a),!f)var v=r?vt(t):Ut(t);return u(v||t,function(o,i){v&&(i=o,o=t[i]),R(a,i,W(o,e,r,n,i,t,c))}),a}function q(t){return Ft(t)?Ge(t):{}}function G(t,e,r){var n=e(t);return yr(t)?n:c(n,r(t))}function J(t){return Ne.call(t)}function K(t){if(!Ft(t)||St(t))return!1;var e=It(t)||h(t)?Re:je;return e.test(Et(t))}function Q(t){return kt(t)&&Mt(t.length)&&!!me[Ne.call(t)]}function X(t){if(!Ot(t))return Ye(t);var e=[];for(var r in Object(t))De.call(t,r)&&"constructor"!=r&&e.push(r);return e}function Y(t){if(!Ft(t))return xt(t);var e=Ot(t),r=[];for(var n in t)("constructor"!=n||!e&&De.call(t,n))&&r.push(n);return r}function Z(t,e,r,n,o){if(t!==e){if(!yr(e)&&!_r(e))var i=Y(e);u(i||e,function(u,c){if(i&&(c=u,u=e[c]),Ft(u))o||(o=new F),tt(t,e,c,r,Z,n,o);else{var a=n?n(t[c],u,c+"",t,e,o):void 0;void 0===a&&(a=u),N(t,c,a)}})}}function tt(t,e,r,n,o,i,u){var c=t[r],a=e[r],f=u.get(a);if(f)return void N(t,r,f);var s=i?i(c,a,r+"",t,e,u):void 0,l=void 0===s;l&&(s=a,yr(a)||_r(a)?yr(c)?s=c:$t(c)?s=st(c):(l=!1,s=W(a,!0)):Bt(a)||Pt(a)?Pt(c)?s=Ct(c):!Ft(c)||n&&It(c)?(l=!1,s=W(a,!0)):s=c:l=!1),l&&(u.set(a,s),o(s,a,n,i,u),u.delete(a)),N(t,r,s)}function et(t,e){return e=Ze(void 0===e?t.length-1:e,0),function(){for(var r=arguments,n=-1,o=Ze(r.length-e,0),u=Array(o);++n<o;)u[n]=r[e+n];n=-1;for(var c=Array(e+1);++n<e;)c[n]=r[n];return c[e]=u,i(t,this,c)}}function rt(t,e){if(e)return t.slice();var r=new t.constructor(t.length);return t.copy(r),r}function nt(t){var e=new t.constructor(t.byteLength);return new We(e).set(new We(t)),e}function ot(t,e){var r=e?nt(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}function it(t,e,n){var o=e?n(p(t),!0):p(t);return a(o,r,new t.constructor)}function ut(t){var e=new t.constructor(t.source,ge.exec(t));return e.lastIndex=t.lastIndex,e}function ct(t,e,r){var n=e?r(y(t),!0):y(t);return a(n,o,new t.constructor)}function at(t){return hr?Object(hr.call(t)):{}}function ft(t,e){var r=e?nt(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}function st(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}function lt(t,e,r,n){r||(r={});for(var o=-1,i=e.length;++o<i;){var u=e[o],c=n?n(r[u],t[u],u,r,t):void 0;R(r,u,void 0===c?t[u]:c)}return r}function ht(t,e){return lt(t,pr(t),e)}function pt(t){return et(function(e,r){var n=-1,o=r.length,i=o>1?r[o-1]:void 0,u=o>2?r[2]:void 0;for(i=t.length>3&&"function"==typeof i?(o--,i):void 0,u&&wt(r[0],r[1],u)&&(i=o<3?void 0:i,o=1),e=Object(e);++n<o;){var c=r[n];c&&t(e,c,n,i)}return e})}function vt(t){return G(t,Ut,pr)}function yt(t,e){var r=t.__data__;return mt(e)?r["string"==typeof e?"string":"hash"]:r.map}function dt(t,e){var r=l(t,e);return K(r)?r:void 0}function _t(t){var e=t.length,r=t.constructor(e);return e&&"string"==typeof t[0]&&De.call(t,"index")&&(r.index=t.index,r.input=t.input),r}function bt(t){return"function"!=typeof t.constructor||Ot(t)?{}:q(qe(t))}function gt(t,e,r,n){var o=t.constructor;switch(e){case ce:return nt(t);case Gt:case Jt:return new o(+t);case ae:return ot(t,n);case fe:case se:case le:case he:case pe:case ve:case ye:case de:case _e:return ft(t,n);case Yt:return it(t,n,r);case Zt:case oe:return new o(t);case re:return ut(t);case ne:return ct(t,n,r);case ie:return at(t)}}function jt(t,e){return e=null==e?Vt:e,!!e&&("number"==typeof t||we.test(t))&&t>-1&&t%1==0&&t<e}function wt(t,e,r){if(!Ft(r))return!1;var n=typeof e;return!!("number"==n?Tt(r)&&jt(e,r.length):"string"==n&&e in r)&&zt(r[e],t)}function mt(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}function St(t){return!!Ce&&Ce in t}function Ot(t){var e=t&&t.constructor,r="function"==typeof e&&e.prototype||ke;return t===r}function At(t,e,r,n,o,i){return Ft(t)&&Ft(e)&&(i.set(e,t),Z(t,e,void 0,At,i),i.delete(e)),t}function xt(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}function Et(t){if(null!=t){try{return Ue.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function zt(t,e){return t===e||t!==t&&e!==e}function Pt(t){return $t(t)&&De.call(t,"callee")&&(!Je.call(t,"callee")||Ne.call(t)==Wt)}function Tt(t){return null!=t&&Mt(t.length)&&!It(t)}function $t(t){return kt(t)&&Tt(t)}function It(t){var e=Ft(t)?Ne.call(t):"";return e==Qt||e==Xt}function Mt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Vt}function Ft(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function kt(t){return!!t&&"object"==typeof t}function Bt(t){if(!kt(t)||Ne.call(t)!=te||h(t))return!1;var e=qe(t);if(null===e)return!0;var r=De.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&Ue.call(r)==Le}function Ct(t){return lt(t,Dt(t))}function Ut(t){return Tt(t)?L(t):X(t)}function Dt(t){return Tt(t)?L(t,!0):Y(t)}function Lt(){return[]}function Nt(){return!1}var Rt=200,Ht="__lodash_hash_undefined__",Vt=9007199254740991,Wt="[object Arguments]",qt="[object Array]",Gt="[object Boolean]",Jt="[object Date]",Kt="[object Error]",Qt="[object Function]",Xt="[object GeneratorFunction]",Yt="[object Map]",Zt="[object Number]",te="[object Object]",ee="[object Promise]",re="[object RegExp]",ne="[object Set]",oe="[object String]",ie="[object Symbol]",ue="[object WeakMap]",ce="[object ArrayBuffer]",ae="[object DataView]",fe="[object Float32Array]",se="[object Float64Array]",le="[object Int8Array]",he="[object Int16Array]",pe="[object Int32Array]",ve="[object Uint8Array]",ye="[object Uint8ClampedArray]",de="[object Uint16Array]",_e="[object Uint32Array]",be=/[\\^$.*+?()[\]{}|]/g,ge=/\w*$/,je=/^\[object .+?Constructor\]$/,we=/^(?:0|[1-9]\d*)$/,me={};me[fe]=me[se]=me[le]=me[he]=me[pe]=me[ve]=me[ye]=me[de]=me[_e]=!0,me[Wt]=me[qt]=me[ce]=me[Gt]=me[ae]=me[Jt]=me[Kt]=me[Qt]=me[Yt]=me[Zt]=me[te]=me[re]=me[ne]=me[oe]=me[ue]=!1;var Se={};Se[Wt]=Se[qt]=Se[ce]=Se[ae]=Se[Gt]=Se[Jt]=Se[fe]=Se[se]=Se[le]=Se[he]=Se[pe]=Se[Yt]=Se[Zt]=Se[te]=Se[re]=Se[ne]=Se[oe]=Se[ie]=Se[ve]=Se[ye]=Se[de]=Se[_e]=!0,Se[Kt]=Se[Qt]=Se[ue]=!1;var Oe="object"==typeof n&&n&&n.Object===Object&&n,Ae="object"==typeof self&&self&&self.Object===Object&&self,xe=Oe||Ae||Function("return this")(),Ee="object"==typeof e&&e&&!e.nodeType&&e,ze=Ee&&"object"==typeof t&&t&&!t.nodeType&&t,Pe=ze&&ze.exports===Ee,Te=Pe&&Oe.process,$e=function(){try{return Te&&Te.binding("util")}catch(t){}}(),Ie=$e&&$e.isTypedArray,Me=Array.prototype,Fe=Function.prototype,ke=Object.prototype,Be=xe["__core-js_shared__"],Ce=function(){var t=/[^.]+$/.exec(Be&&Be.keys&&Be.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Ue=Fe.toString,De=ke.hasOwnProperty,Le=Ue.call(Object),Ne=ke.toString,Re=RegExp("^"+Ue.call(De).replace(be,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),He=Pe?xe.Buffer:void 0,Ve=xe.Symbol,We=xe.Uint8Array,qe=v(Object.getPrototypeOf,Object),Ge=Object.create,Je=ke.propertyIsEnumerable,Ke=Me.splice,Qe=Object.getOwnPropertySymbols,Xe=He?He.isBuffer:void 0,Ye=v(Object.keys,Object),Ze=Math.max,tr=dt(xe,"DataView"),er=dt(xe,"Map"),rr=dt(xe,"Promise"),nr=dt(xe,"Set"),or=dt(xe,"WeakMap"),ir=dt(Object,"create"),ur=Et(tr),cr=Et(er),ar=Et(rr),fr=Et(nr),sr=Et(or),lr=Ve?Ve.prototype:void 0,hr=lr?lr.valueOf:void 0;d.prototype.clear=_,d.prototype.delete=b,d.prototype.get=g,d.prototype.has=j,d.prototype.set=w,m.prototype.clear=S,m.prototype.delete=O,m.prototype.get=A,m.prototype.has=x,m.prototype.set=E,z.prototype.clear=P,z.prototype.delete=T,z.prototype.get=$,z.prototype.has=I,z.prototype.set=M,F.prototype.clear=k,F.prototype.delete=B,F.prototype.get=C,F.prototype.has=U,F.prototype.set=D;var pr=Qe?v(Qe,Object):Lt,vr=J;(tr&&vr(new tr(new ArrayBuffer(1)))!=ae||er&&vr(new er)!=Yt||rr&&vr(rr.resolve())!=ee||nr&&vr(new nr)!=ne||or&&vr(new or)!=ue)&&(vr=function(t){var e=Ne.call(t),r=e==te?t.constructor:void 0,n=r?Et(r):void 0;if(n)switch(n){case ur:return ae;case cr:return Yt;case ar:return ee;case fr:return ne;case sr:return ue}return e});var yr=Array.isArray,dr=Xe||Nt,_r=Ie?s(Ie):Q,br=et(function(t){return t.push(void 0,At),i(gr,void 0,t)}),gr=pt(function(t,e,r,n){Z(t,e,r,n)});t.exports=br}),i=function(t,e){return function(){return t.apply(e,arguments)}};r=function(){function t(t,e,r){this.el=t,this.children=e,this.opt=r,this.saveStyle=i(this.saveStyle,this),this.originalElement=this.el,this.el=this.el.cloneNode(!1)}return t.prototype.saveStyle=function(){if(this.el.hasAttribute("style"))return this.el.setAttribute(this.opt.originalStyle,this.el.getAttribute("style"))},t.prototype.serializeStyle=function(){var t,e,r,n,o;if(this.el.currentStyle)return this.el.setAttribute("style",this.el.currentStyle);for(o=getComputedStyle(this.el),n=[],t=0,e=o.length;t<e;t++)r=o[t],n.push(this.el.style[r]=o[r]);return n},t.prototype.update=function(){return this.saveStyle(),this.serializeStyle()},t.prototype.interweaveText=function(){var t,e,r,n,o,i,u,c,a,f,s;if(e=this.originalElement.textContent,!e)return this.children;for(f=[[],0],n=f[0],i=f[1],s=this.originalElement.children,r=o=0,u=s.length;o<u;r=++o)t=s[r],c=t.textContent,c&&(a=e.indexOf(c,i),a>0&&(n.push(e.substring(i,a)),i=a),n.push(this.children[r]),i+=c.length);return n.push(e.substring(i)),n},t.prototype.toString=function(){var t,e;return this.update(),e=this.el.tagName,t=[e],this.el.innerHTML=this.interweaveText().join(""),this.el.outerHTML},t}();var u,c,a,f,s=r;f=o,a=t,c=s,u=function(){function t(t){this.opt=null!=t?t:{},f(this.opt,{originalStyle:"data-originalStyle",originalSrc:"data-originalSrc"})}return t.prototype.elementSerializer=c,t.prototype.serialize=function(t){var e,r,n,o,i,u,c,f;for(o=t.tagName+"Serializer",e=null!=(c=this[o])?c:this.elementSerializer,n=[],f=t.children,i=0,u=f.length;i<u;i++)r=f[i],n.push(this.serialize(r));return a.all(n).then(function(r){return function(n){var o;return o=new e(t,n,r.opt),o.toString()}}(this))},t}();var l=u;return l});
