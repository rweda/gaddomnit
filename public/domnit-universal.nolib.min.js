!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("bluebird")):"function"==typeof define&&define.amd?define(["bluebird"],e):t.Domnit=e(t.P)}(this,function(t){"use strict";t="default"in t?t.default:t;var e,i=function(t,e){return function(){return t.apply(e,arguments)}};e=function(){function t(t,e,n){this.el=t,this.children=e,this.opt=n,this.saveStyle=i(this.saveStyle,this),this.originalElement=this.el,this.el=this.el.cloneNode(!1)}return t.prototype.saveStyle=function(){if(this.el.hasAttribute("style"))return this.el.setAttribute(this.opt.originalStyle,this.el.getAttribute("style"))},t.prototype.serializeStyle=function(){var t,e,i,n,r;if(this.el.currentStyle)return this.el.setAttribute("style",this.el.currentStyle);for(r=getComputedStyle(this.el),n=[],t=0,e=r.length;t<e;t++)i=r[t],n.push(this.el.style[i]=r[i]);return n},t.prototype.update=function(){return this.saveStyle(),this.serializeStyle()},t.prototype.interweaveText=function(){var t,e,i,n,r,l,s,o,u,h,a;if(e=this.originalElement.textContent,!e)return this.children;for(h=[[],0],n=h[0],l=h[1],a=this.originalElement.children,i=r=0,s=a.length;r<s;i=++r)t=a[i],o=t.textContent,o&&(u=e.indexOf(o,l),u>0&&(n.push(e.substring(l,u)),l=u),n.push(this.children[i]),l+=o.length);return n.push(e.substring(l)),n},t.prototype.toString=function(){var t,e;return this.update(),e=this.el.tagName,t=[e],this.el.innerHTML=this.interweaveText().join(""),this.el.outerHTML},t}();var n,r,l,s=e;l=t,r=s,n=function(){function t(t){this.opt=t}return t.prototype.elementSerializer=r,t.prototype.serialize=function(t){var e,i,n,r,s,o,u,h;for(r=t.tagName+"Serializer",e=null!=(u=this[r])?u:this.elementSerializer,n=[],h=t.children,s=0,o=h.length;s<o;s++)i=h[s],n.push(this.serialize(i));return l.all(n).then(function(i){return function(n){var r;return r=new e(t,n,i.opt),r.toString()}}(this))},t}();var o=n;return o});
