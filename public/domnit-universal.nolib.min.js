!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("bluebird")):"function"==typeof define&&define.amd?define(["bluebird"],e):t.Domnit=e(t.P)}(this,function(t){"use strict";function e(t,e){return e={exports:{}},t(e,e.exports),e.exports}t="default"in t?t.default:t;var r,n,o="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},i=e(function(t,e){function r(t,e){return t.set(e[0],e[1]),t}function n(t,e){return t.add(e),t}function i(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function u(t,e){for(var r=-1,n=t?t.length:0;++r<n&&e(t[r],r,t)!==!1;);return t}function c(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}function a(t,e,r,n){var o=-1,i=t?t.length:0;for(n&&i&&(r=t[++o]);++o<i;)r=e(r,t[o],o,t);return r}function s(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}function f(t){return function(e){return t(e)}}function l(t,e){return null==t?void 0:t[e]}function p(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function h(t){var e=-1,r=Array(t.size);return t.forEach(function(t,n){r[++e]=[n,t]}),r}function y(t,e){return function(r){return t(e(r))}}function v(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}function d(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function _(){this.__data__=ir?ir(null):{}}function b(t){return this.has(t)&&delete this.__data__[t]}function g(t){var e=this.__data__;if(ir){var r=e[t];return r===Rt?void 0:r}return Ie.call(e,t)?e[t]:void 0}function m(t){var e=this.__data__;return ir?void 0!==e[t]:Ie.call(e,t)}function j(t,e){var r=this.__data__;return r[t]=ir&&void 0===e?Rt:e,this}function w(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function S(){this.__data__=[]}function A(t){var e=this.__data__,r=R(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():Ke.call(e,r,1),!0}function O(t){var e=this.__data__,r=R(e,t);return r<0?void 0:e[r][1]}function x(t){return R(this.__data__,t)>-1}function E(t,e){var r=this.__data__,n=R(r,t);return n<0?r.push([t,e]):r[n][1]=e,this}function T(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function C(){this.__data__={hash:new d,map:new(er||w),string:new d}}function z(t){return vt(this,t).delete(t)}function B(t){return vt(this,t).get(t)}function H(t){return vt(this,t).has(t)}function M(t,e){return vt(this,t).set(t,e),this}function P(t){this.__data__=new w(t)}function L(){this.__data__=new w}function k(t){return this.__data__.delete(t)}function N(t){return this.__data__.get(t)}function $(t){return this.__data__.has(t)}function I(t,e){var r=this.__data__;if(r instanceof w){var n=r.__data__;if(!er||n.length<Ut-1)return n.push([t,e]),this;r=this.__data__=new T(n)}return r.set(t,e),this}function D(t,e){var r=vr(t)||Ct(t)?s(t.length,String):[],n=r.length,o=!!n;for(var i in t)!e&&!Ie.call(t,i)||o&&("length"==i||mt(i,n))||r.push(i);return r}function F(t,e,r){(void 0===r||Tt(t[e],r))&&("number"!=typeof e||void 0!==r||e in t)||(t[e]=r)}function U(t,e,r){var n=t[e];Ie.call(t,e)&&Tt(n,r)&&(void 0!==r||e in t)||(t[e]=r)}function R(t,e){for(var r=t.length;r--;)if(Tt(t[r][0],e))return r;return-1}function V(t,e){return t&&lt(e,$t(e),t)}function W(t,e,r,n,o,i,c){var a;if(n&&(a=i?n(t,o,i,c):n(t)),void 0!==a)return a;if(!Pt(t))return t;var s=vr(t);if(s){if(a=_t(t),!e)return ft(t,a)}else{var f=yr(t),l=f==Qt||f==Xt;if(dr(t))return rt(t,e);if(f==te||f==Wt||l&&!i){if(p(t))return i?t:{};if(a=bt(l?{}:t),!e)return pt(t,V(a,t))}else{if(!Se[f])return i?t:{};a=gt(t,f,W,e)}}c||(c=new P);var h=c.get(t);if(h)return h;if(c.set(t,a),!s)var y=r?yt(t):$t(t);return u(y||t,function(o,i){y&&(i=o,o=t[i]),U(a,i,W(o,e,r,n,i,t,c))}),a}function q(t){return Pt(t)?Ge(t):{}}function G(t,e,r){var n=e(t);return vr(t)?n:c(n,r(t))}function J(t){return Fe.call(t)}function K(t){if(!Pt(t)||St(t))return!1;var e=Ht(t)||p(t)?Ue:me;return e.test(Et(t))}function Q(t){return Lt(t)&&Mt(t.length)&&!!we[Fe.call(t)]}function X(t){if(!At(t))return Ye(t);var e=[];for(var r in Object(t))Ie.call(t,r)&&"constructor"!=r&&e.push(r);return e}function Y(t){if(!Pt(t))return xt(t);var e=At(t),r=[];for(var n in t)("constructor"!=n||!e&&Ie.call(t,n))&&r.push(n);return r}function Z(t,e,r,n,o){if(t!==e){if(!vr(e)&&!_r(e))var i=Y(e);u(i||e,function(u,c){if(i&&(c=u,u=e[c]),Pt(u))o||(o=new P),tt(t,e,c,r,Z,n,o);else{var a=n?n(t[c],u,c+"",t,e,o):void 0;void 0===a&&(a=u),F(t,c,a)}})}}function tt(t,e,r,n,o,i,u){var c=t[r],a=e[r],s=u.get(a);if(s)return void F(t,r,s);var f=i?i(c,a,r+"",t,e,u):void 0,l=void 0===f;l&&(f=a,vr(a)||_r(a)?vr(c)?f=c:Bt(c)?f=ft(c):(l=!1,f=W(a,!0)):kt(a)||Ct(a)?Ct(c)?f=Nt(c):!Pt(c)||n&&Ht(c)?(l=!1,f=W(a,!0)):f=c:l=!1),l&&(u.set(a,f),o(f,a,n,i,u),u.delete(a)),F(t,r,f)}function et(t,e){return e=Ze(void 0===e?t.length-1:e,0),function(){for(var r=arguments,n=-1,o=Ze(r.length-e,0),u=Array(o);++n<o;)u[n]=r[e+n];n=-1;for(var c=Array(e+1);++n<e;)c[n]=r[n];return c[e]=u,i(t,this,c)}}function rt(t,e){if(e)return t.slice();var r=new t.constructor(t.length);return t.copy(r),r}function nt(t){var e=new t.constructor(t.byteLength);return new We(e).set(new We(t)),e}function ot(t,e){var r=e?nt(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}function it(t,e,n){var o=e?n(h(t),!0):h(t);return a(o,r,new t.constructor)}function ut(t){var e=new t.constructor(t.source,ge.exec(t));return e.lastIndex=t.lastIndex,e}function ct(t,e,r){var o=e?r(v(t),!0):v(t);return a(o,n,new t.constructor)}function at(t){return pr?Object(pr.call(t)):{}}function st(t,e){var r=e?nt(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}function ft(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}function lt(t,e,r,n){r||(r={});for(var o=-1,i=e.length;++o<i;){var u=e[o],c=n?n(r[u],t[u],u,r,t):void 0;U(r,u,void 0===c?t[u]:c)}return r}function pt(t,e){return lt(t,hr(t),e)}function ht(t){return et(function(e,r){var n=-1,o=r.length,i=o>1?r[o-1]:void 0,u=o>2?r[2]:void 0;for(i=t.length>3&&"function"==typeof i?(o--,i):void 0,u&&jt(r[0],r[1],u)&&(i=o<3?void 0:i,o=1),e=Object(e);++n<o;){var c=r[n];c&&t(e,c,n,i)}return e})}function yt(t){return G(t,$t,hr)}function vt(t,e){var r=t.__data__;return wt(e)?r["string"==typeof e?"string":"hash"]:r.map}function dt(t,e){var r=l(t,e);return K(r)?r:void 0}function _t(t){var e=t.length,r=t.constructor(e);return e&&"string"==typeof t[0]&&Ie.call(t,"index")&&(r.index=t.index,r.input=t.input),r}function bt(t){return"function"!=typeof t.constructor||At(t)?{}:q(qe(t))}function gt(t,e,r,n){var o=t.constructor;switch(e){case ce:return nt(t);case Gt:case Jt:return new o(+t);case ae:return ot(t,n);case se:case fe:case le:case pe:case he:case ye:case ve:case de:case _e:return st(t,n);case Yt:return it(t,n,r);case Zt:case oe:return new o(t);case re:return ut(t);case ne:return ct(t,n,r);case ie:return at(t)}}function mt(t,e){return e=null==e?Vt:e,!!e&&("number"==typeof t||je.test(t))&&t>-1&&t%1==0&&t<e}function jt(t,e,r){if(!Pt(r))return!1;var n=typeof e;return!!("number"==n?zt(r)&&mt(e,r.length):"string"==n&&e in r)&&Tt(r[e],t)}function wt(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}function St(t){return!!Ne&&Ne in t}function At(t){var e=t&&t.constructor,r="function"==typeof e&&e.prototype||Le;return t===r}function Ot(t,e,r,n,o,i){return Pt(t)&&Pt(e)&&(i.set(e,t),Z(t,e,void 0,Ot,i),i.delete(e)),t}function xt(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}function Et(t){if(null!=t){try{return $e.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Tt(t,e){return t===e||t!==t&&e!==e}function Ct(t){return Bt(t)&&Ie.call(t,"callee")&&(!Je.call(t,"callee")||Fe.call(t)==Wt)}function zt(t){return null!=t&&Mt(t.length)&&!Ht(t)}function Bt(t){return Lt(t)&&zt(t)}function Ht(t){var e=Pt(t)?Fe.call(t):"";return e==Qt||e==Xt}function Mt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Vt}function Pt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Lt(t){return!!t&&"object"==typeof t}function kt(t){if(!Lt(t)||Fe.call(t)!=te||p(t))return!1;var e=qe(t);if(null===e)return!0;var r=Ie.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&$e.call(r)==De}function Nt(t){return lt(t,It(t))}function $t(t){return zt(t)?D(t):X(t)}function It(t){return zt(t)?D(t,!0):Y(t)}function Dt(){return[]}function Ft(){return!1}var Ut=200,Rt="__lodash_hash_undefined__",Vt=9007199254740991,Wt="[object Arguments]",qt="[object Array]",Gt="[object Boolean]",Jt="[object Date]",Kt="[object Error]",Qt="[object Function]",Xt="[object GeneratorFunction]",Yt="[object Map]",Zt="[object Number]",te="[object Object]",ee="[object Promise]",re="[object RegExp]",ne="[object Set]",oe="[object String]",ie="[object Symbol]",ue="[object WeakMap]",ce="[object ArrayBuffer]",ae="[object DataView]",se="[object Float32Array]",fe="[object Float64Array]",le="[object Int8Array]",pe="[object Int16Array]",he="[object Int32Array]",ye="[object Uint8Array]",ve="[object Uint8ClampedArray]",de="[object Uint16Array]",_e="[object Uint32Array]",be=/[\\^$.*+?()[\]{}|]/g,ge=/\w*$/,me=/^\[object .+?Constructor\]$/,je=/^(?:0|[1-9]\d*)$/,we={};we[se]=we[fe]=we[le]=we[pe]=we[he]=we[ye]=we[ve]=we[de]=we[_e]=!0,we[Wt]=we[qt]=we[ce]=we[Gt]=we[ae]=we[Jt]=we[Kt]=we[Qt]=we[Yt]=we[Zt]=we[te]=we[re]=we[ne]=we[oe]=we[ue]=!1;var Se={};Se[Wt]=Se[qt]=Se[ce]=Se[ae]=Se[Gt]=Se[Jt]=Se[se]=Se[fe]=Se[le]=Se[pe]=Se[he]=Se[Yt]=Se[Zt]=Se[te]=Se[re]=Se[ne]=Se[oe]=Se[ie]=Se[ye]=Se[ve]=Se[de]=Se[_e]=!0,Se[Kt]=Se[Qt]=Se[ue]=!1;var Ae="object"==typeof o&&o&&o.Object===Object&&o,Oe="object"==typeof self&&self&&self.Object===Object&&self,xe=Ae||Oe||Function("return this")(),Ee="object"==typeof e&&e&&!e.nodeType&&e,Te=Ee&&"object"==typeof t&&t&&!t.nodeType&&t,Ce=Te&&Te.exports===Ee,ze=Ce&&Ae.process,Be=function(){try{return ze&&ze.binding("util")}catch(t){}}(),He=Be&&Be.isTypedArray,Me=Array.prototype,Pe=Function.prototype,Le=Object.prototype,ke=xe["__core-js_shared__"],Ne=function(){var t=/[^.]+$/.exec(ke&&ke.keys&&ke.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),$e=Pe.toString,Ie=Le.hasOwnProperty,De=$e.call(Object),Fe=Le.toString,Ue=RegExp("^"+$e.call(Ie).replace(be,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Re=Ce?xe.Buffer:void 0,Ve=xe.Symbol,We=xe.Uint8Array,qe=y(Object.getPrototypeOf,Object),Ge=Object.create,Je=Le.propertyIsEnumerable,Ke=Me.splice,Qe=Object.getOwnPropertySymbols,Xe=Re?Re.isBuffer:void 0,Ye=y(Object.keys,Object),Ze=Math.max,tr=dt(xe,"DataView"),er=dt(xe,"Map"),rr=dt(xe,"Promise"),nr=dt(xe,"Set"),or=dt(xe,"WeakMap"),ir=dt(Object,"create"),ur=Et(tr),cr=Et(er),ar=Et(rr),sr=Et(nr),fr=Et(or),lr=Ve?Ve.prototype:void 0,pr=lr?lr.valueOf:void 0;d.prototype.clear=_,d.prototype.delete=b,d.prototype.get=g,d.prototype.has=m,d.prototype.set=j,w.prototype.clear=S,w.prototype.delete=A,w.prototype.get=O,w.prototype.has=x,w.prototype.set=E,T.prototype.clear=C,T.prototype.delete=z,T.prototype.get=B,T.prototype.has=H,T.prototype.set=M,P.prototype.clear=L,P.prototype.delete=k,P.prototype.get=N,P.prototype.has=$,P.prototype.set=I;var hr=Qe?y(Qe,Object):Dt,yr=J;(tr&&yr(new tr(new ArrayBuffer(1)))!=ae||er&&yr(new er)!=Yt||rr&&yr(rr.resolve())!=ee||nr&&yr(new nr)!=ne||or&&yr(new or)!=ue)&&(yr=function(t){var e=Fe.call(t),r=e==te?t.constructor:void 0,n=r?Et(r):void 0;if(n)switch(n){case ur:return ae;case cr:return Yt;case ar:return ee;case sr:return ne;case fr:return ue}return e});var vr=Array.isArray,dr=Xe||Ft,_r=He?f(He):Q,br=et(function(t){return t.push(void 0,Ot),i(gr,void 0,t)}),gr=ht(function(t,e,r,n){Z(t,e,r,n)});t.exports=br});n=t,r=function(){function t(){}return t.stored={},t.get=function(t){return this.stored[t]?this.stored[t]:this.stored=this.getNoCache(t)},t.getNoCache=function(t){return new n(function(e,r){var n,o,i,u,c,a,s,f,l,p;for(c=document.createElement("iframe"),document.body.appendChild(c),i=null!=(l=c.contentDocument)?l:c.contentWindow.document,o=i.createElement(t),i.body.appendChild(o),p={},n=o.ownerDocument.defaultView.getComputedStyle(o),u=a=0,s=n.length;a<s;u=++a)f=n[u],p[u]=f,p[f]=n[f];return p.cssText=n.cssText,document.body.removeChild(c),e(p)})},t}();var u,c,a,s=r,f=function(t,e){return function(){return t.apply(e,arguments)}};u=s,a=t,c=function(){function t(t,e,r){this.el=t,this.children=e,this.opt=r,this.saveStyle=f(this.saveStyle,this),this.originalElement=this.el,this.el=this.el.cloneNode(!1)}return t.prototype.saveStyle=function(){if(this.el.hasAttribute("style"))return this.el.setAttribute(this.opt.originalStyle,this.el.getAttribute("style"))},t.prototype.serializeStyle=function(){var t;return(null!=(t=this.opt.style)?t[this.el.tagName.toLowerCase()]:void 0)===!1?(this.el.removeAttribute("style"),a.resolve()):this.el.currentStyle?this.el.setAttribute("style",this.originalElement.currentStyle):this.opt.useBrowserStyle?u.get(this.el.tagName).then(function(t){return function(e){var r,n,o,i,u;for(u=getComputedStyle(t.originalElement),i=[],r=0,n=u.length;r<n;r++)o=u[r],u[o]!==e[o]&&i.push(t.el.style[o]=u[o]);return i}}(this)):this.el.style.cssText=getComputedStyle(this.originalElement).cssText},t.prototype.update=function(){return this.saveStyle(),this.serializeStyle()},t.prototype.interweaveText=function(){var t,e,r,n,o,i,u,c,a,s,f;if(e=this.originalElement.textContent,!e)return this.children;for(s=[[],0],n=s[0],i=s[1],f=this.originalElement.children,r=o=0,u=f.length;o<u;r=++o)t=f[r],c=t.textContent,c?(a=e.indexOf(c,i),a>0&&(n.push(e.substring(i,a)),i=a),n.push(this.children[r]),i+=c.length):n.push(this.children[r]);return n.push(e.substring(i)),n},t.prototype.toString=function(){return a.resolve(this.update()).then(function(t){return function(){var e,r;return r=t.el.tagName,e=[r],t.el.innerHTML=t.interweaveText().join(""),t.el.outerHTML}}(this))},t}();var l,p,h=c,y=function(t,e){function r(){this.constructor=t}for(var n in e)v.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},v={}.hasOwnProperty;l=h,p=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return y(e,t),e.prototype.moveSrc=function(){if(this.el.hasAttribute("src"))return this.el.setAttribute(this.opt.originalSrc,this.el.getAttribute("src")),this.el.removeAttribute("src")},e.prototype.removeBody=function(){return this.el.innerHTML=""},e.prototype.toString=function(){return e.__super__.toString.call(this).then(function(t){return function(){return t.moveSrc(),t.removeBody(),t.el.outerHTML}}(this))},e}(l);var d,_,b=p,g=function(t,e){function r(){this.constructor=t}for(var n in e)m.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},m={}.hasOwnProperty;d=h,_=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return g(e,t),e.prototype.moveHref=function(){if(this.el.hasAttribute("href"))return this.el.setAttribute(this.opt.linkHref,this.el.getAttribute("href")),this.el.removeAttribute("href")},e.prototype.update=function(){return e.__super__.update.call(this).then(function(t){return function(){return t.moveHref()}}(this))},e}(d);var j,w,S=_,A=function(t,e){function r(){this.constructor=t}for(var n in e)O.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},O={}.hasOwnProperty;j=h,w=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return A(e,t),e.prototype.removeBody=function(){return this.el.innerHTML=""},e.prototype.toString=function(){return e.__super__.toString.call(this).then(function(t){return function(){return t.removeBody(),t.el.outerHTML}}(this))},e}(j);var x,E,T,C,z,B,H,M=w;H=i,C=t,E=h,z=b,T=S,B=M,x=function(){function t(t){this.opt=null!=t?t:{},H(this.opt,{originalStyle:"data-originalStyle",originalSrc:"data-originalSrc",linkHref:"data-originalHref",useBrowserStyle:!0,style:{head:!1,title:!1,link:!1,meta:!1,style:!1,script:!1},filter:null})}return t.ElementSerializer=E,t.prototype.elementSerializer=E,t.prototype.scriptSerializer=z,t.prototype.linkSerializer=T,t.prototype.styleSerializer=B,t.prototype.serialize=function(t){var e,r,n,o,i,u,c,a;if(this.opt.filter&&this.opt.filter(t))return"";for(o=t.tagName.toLowerCase()+"Serializer",e=null!=(c=this[o])?c:this.elementSerializer,n=[],a=t.children,i=0,u=a.length;i<u;i++)r=a[i],n.push(this.serialize(r));return C.all(n).then(function(r){return function(n){var o;return o=new e(t,n,r.opt),o.toString()}}(this))},t}();var P=x;return P});
