!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("bluebird")):"function"==typeof define&&define.amd?define(["bluebird"],e):t.Domnit=e(t.P)}(this,function(t){"use strict";function e(t,e){return e={exports:{}},t(e,e.exports),e.exports}t="default"in t?t.default:t;var r,n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},o=e(function(t,e){function r(t,e){return t.set(e[0],e[1]),t}function o(t,e){return t.add(e),t}function i(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function u(t,e){for(var r=-1,n=t?t.length:0;++r<n&&e(t[r],r,t)!==!1;);return t}function c(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}function a(t,e,r,n){var o=-1,i=t?t.length:0;for(n&&i&&(r=t[++o]);++o<i;)r=e(r,t[o],o,t);return r}function s(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}function f(t){return function(e){return t(e)}}function l(t,e){return null==t?void 0:t[e]}function h(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function p(t){var e=-1,r=Array(t.size);return t.forEach(function(t,n){r[++e]=[n,t]}),r}function y(t,e){return function(r){return t(e(r))}}function v(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}function d(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function _(){this.__data__=ir?ir(null):{}}function b(t){return this.has(t)&&delete this.__data__[t]}function g(t){var e=this.__data__;if(ir){var r=e[t];return r===Rt?void 0:r}return Ue.call(e,t)?e[t]:void 0}function j(t){var e=this.__data__;return ir?void 0!==e[t]:Ue.call(e,t)}function w(t,e){var r=this.__data__;return r[t]=ir&&void 0===e?Rt:e,this}function m(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function A(){this.__data__=[]}function S(t){var e=this.__data__,r=R(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():Ke.call(e,r,1),!0}function O(t){var e=this.__data__,r=R(e,t);return r<0?void 0:e[r][1]}function x(t){return R(this.__data__,t)>-1}function z(t,e){var r=this.__data__,n=R(r,t);return n<0?r.push([t,e]):r[n][1]=e,this}function E(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function T(){this.__data__={hash:new d,map:new(er||m),string:new d}}function M(t){return vt(this,t).delete(t)}function P(t){return vt(this,t).get(t)}function C(t){return vt(this,t).has(t)}function $(t,e){return vt(this,t).set(t,e),this}function B(t){this.__data__=new m(t)}function I(){this.__data__=new m}function L(t){return this.__data__.delete(t)}function F(t){return this.__data__.get(t)}function k(t){return this.__data__.has(t)}function U(t,e){var r=this.__data__;if(r instanceof m){var n=r.__data__;if(!er||n.length<Nt-1)return n.push([t,e]),this;r=this.__data__=new E(n)}return r.set(t,e),this}function D(t,e){var r=vr(t)||Tt(t)?s(t.length,String):[],n=r.length,o=!!n;for(var i in t)!e&&!Ue.call(t,i)||o&&("length"==i||jt(i,n))||r.push(i);return r}function H(t,e,r){(void 0===r||Et(t[e],r))&&("number"!=typeof e||void 0!==r||e in t)||(t[e]=r)}function N(t,e,r){var n=t[e];Ue.call(t,e)&&Et(n,r)&&(void 0!==r||e in t)||(t[e]=r)}function R(t,e){for(var r=t.length;r--;)if(Et(t[r][0],e))return r;return-1}function V(t,e){return t&&lt(e,kt(e),t)}function W(t,e,r,n,o,i,c){var a;if(n&&(a=i?n(t,o,i,c):n(t)),void 0!==a)return a;if(!Bt(t))return t;var s=vr(t);if(s){if(a=_t(t),!e)return ft(t,a)}else{var f=yr(t),l=f==Qt||f==Xt;if(dr(t))return rt(t,e);if(f==te||f==Wt||l&&!i){if(h(t))return i?t:{};if(a=bt(l?{}:t),!e)return ht(t,V(a,t))}else{if(!Ae[f])return i?t:{};a=gt(t,f,W,e)}}c||(c=new B);var p=c.get(t);if(p)return p;if(c.set(t,a),!s)var y=r?yt(t):kt(t);return u(y||t,function(o,i){y&&(i=o,o=t[i]),N(a,i,W(o,e,r,n,i,t,c))}),a}function q(t){return Bt(t)?Ge(t):{}}function G(t,e,r){var n=e(t);return vr(t)?n:c(n,r(t))}function J(t){return He.call(t)}function K(t){if(!Bt(t)||At(t))return!1;var e=Ct(t)||h(t)?Ne:je;return e.test(zt(t))}function Q(t){return It(t)&&$t(t.length)&&!!me[He.call(t)]}function X(t){if(!St(t))return Ye(t);var e=[];for(var r in Object(t))Ue.call(t,r)&&"constructor"!=r&&e.push(r);return e}function Y(t){if(!Bt(t))return xt(t);var e=St(t),r=[];for(var n in t)("constructor"!=n||!e&&Ue.call(t,n))&&r.push(n);return r}function Z(t,e,r,n,o){if(t!==e){if(!vr(e)&&!_r(e))var i=Y(e);u(i||e,function(u,c){if(i&&(c=u,u=e[c]),Bt(u))o||(o=new B),tt(t,e,c,r,Z,n,o);else{var a=n?n(t[c],u,c+"",t,e,o):void 0;void 0===a&&(a=u),H(t,c,a)}})}}function tt(t,e,r,n,o,i,u){var c=t[r],a=e[r],s=u.get(a);if(s)return void H(t,r,s);var f=i?i(c,a,r+"",t,e,u):void 0,l=void 0===f;l&&(f=a,vr(a)||_r(a)?vr(c)?f=c:Pt(c)?f=ft(c):(l=!1,f=W(a,!0)):Lt(a)||Tt(a)?Tt(c)?f=Ft(c):!Bt(c)||n&&Ct(c)?(l=!1,f=W(a,!0)):f=c:l=!1),l&&(u.set(a,f),o(f,a,n,i,u),u.delete(a)),H(t,r,f)}function et(t,e){return e=Ze(void 0===e?t.length-1:e,0),function(){for(var r=arguments,n=-1,o=Ze(r.length-e,0),u=Array(o);++n<o;)u[n]=r[e+n];n=-1;for(var c=Array(e+1);++n<e;)c[n]=r[n];return c[e]=u,i(t,this,c)}}function rt(t,e){if(e)return t.slice();var r=new t.constructor(t.length);return t.copy(r),r}function nt(t){var e=new t.constructor(t.byteLength);return new We(e).set(new We(t)),e}function ot(t,e){var r=e?nt(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}function it(t,e,n){var o=e?n(p(t),!0):p(t);return a(o,r,new t.constructor)}function ut(t){var e=new t.constructor(t.source,ge.exec(t));return e.lastIndex=t.lastIndex,e}function ct(t,e,r){var n=e?r(v(t),!0):v(t);return a(n,o,new t.constructor)}function at(t){return hr?Object(hr.call(t)):{}}function st(t,e){var r=e?nt(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}function ft(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}function lt(t,e,r,n){r||(r={});for(var o=-1,i=e.length;++o<i;){var u=e[o],c=n?n(r[u],t[u],u,r,t):void 0;N(r,u,void 0===c?t[u]:c)}return r}function ht(t,e){return lt(t,pr(t),e)}function pt(t){return et(function(e,r){var n=-1,o=r.length,i=o>1?r[o-1]:void 0,u=o>2?r[2]:void 0;for(i=t.length>3&&"function"==typeof i?(o--,i):void 0,u&&wt(r[0],r[1],u)&&(i=o<3?void 0:i,o=1),e=Object(e);++n<o;){var c=r[n];c&&t(e,c,n,i)}return e})}function yt(t){return G(t,kt,pr)}function vt(t,e){var r=t.__data__;return mt(e)?r["string"==typeof e?"string":"hash"]:r.map}function dt(t,e){var r=l(t,e);return K(r)?r:void 0}function _t(t){var e=t.length,r=t.constructor(e);return e&&"string"==typeof t[0]&&Ue.call(t,"index")&&(r.index=t.index,r.input=t.input),r}function bt(t){return"function"!=typeof t.constructor||St(t)?{}:q(qe(t))}function gt(t,e,r,n){var o=t.constructor;switch(e){case ce:return nt(t);case Gt:case Jt:return new o(+t);case ae:return ot(t,n);case se:case fe:case le:case he:case pe:case ye:case ve:case de:case _e:return st(t,n);case Yt:return it(t,n,r);case Zt:case oe:return new o(t);case re:return ut(t);case ne:return ct(t,n,r);case ie:return at(t)}}function jt(t,e){return e=null==e?Vt:e,!!e&&("number"==typeof t||we.test(t))&&t>-1&&t%1==0&&t<e}function wt(t,e,r){if(!Bt(r))return!1;var n=typeof e;return!!("number"==n?Mt(r)&&jt(e,r.length):"string"==n&&e in r)&&Et(r[e],t)}function mt(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}function At(t){return!!Fe&&Fe in t}function St(t){var e=t&&t.constructor,r="function"==typeof e&&e.prototype||Ie;return t===r}function Ot(t,e,r,n,o,i){return Bt(t)&&Bt(e)&&(i.set(e,t),Z(t,e,void 0,Ot,i),i.delete(e)),t}function xt(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}function zt(t){if(null!=t){try{return ke.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Et(t,e){return t===e||t!==t&&e!==e}function Tt(t){return Pt(t)&&Ue.call(t,"callee")&&(!Je.call(t,"callee")||He.call(t)==Wt)}function Mt(t){return null!=t&&$t(t.length)&&!Ct(t)}function Pt(t){return It(t)&&Mt(t)}function Ct(t){var e=Bt(t)?He.call(t):"";return e==Qt||e==Xt}function $t(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Vt}function Bt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function It(t){return!!t&&"object"==typeof t}function Lt(t){if(!It(t)||He.call(t)!=te||h(t))return!1;var e=qe(t);if(null===e)return!0;var r=Ue.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&ke.call(r)==De}function Ft(t){return lt(t,Ut(t))}function kt(t){return Mt(t)?D(t):X(t)}function Ut(t){return Mt(t)?D(t,!0):Y(t)}function Dt(){return[]}function Ht(){return!1}var Nt=200,Rt="__lodash_hash_undefined__",Vt=9007199254740991,Wt="[object Arguments]",qt="[object Array]",Gt="[object Boolean]",Jt="[object Date]",Kt="[object Error]",Qt="[object Function]",Xt="[object GeneratorFunction]",Yt="[object Map]",Zt="[object Number]",te="[object Object]",ee="[object Promise]",re="[object RegExp]",ne="[object Set]",oe="[object String]",ie="[object Symbol]",ue="[object WeakMap]",ce="[object ArrayBuffer]",ae="[object DataView]",se="[object Float32Array]",fe="[object Float64Array]",le="[object Int8Array]",he="[object Int16Array]",pe="[object Int32Array]",ye="[object Uint8Array]",ve="[object Uint8ClampedArray]",de="[object Uint16Array]",_e="[object Uint32Array]",be=/[\\^$.*+?()[\]{}|]/g,ge=/\w*$/,je=/^\[object .+?Constructor\]$/,we=/^(?:0|[1-9]\d*)$/,me={};me[se]=me[fe]=me[le]=me[he]=me[pe]=me[ye]=me[ve]=me[de]=me[_e]=!0,me[Wt]=me[qt]=me[ce]=me[Gt]=me[ae]=me[Jt]=me[Kt]=me[Qt]=me[Yt]=me[Zt]=me[te]=me[re]=me[ne]=me[oe]=me[ue]=!1;var Ae={};Ae[Wt]=Ae[qt]=Ae[ce]=Ae[ae]=Ae[Gt]=Ae[Jt]=Ae[se]=Ae[fe]=Ae[le]=Ae[he]=Ae[pe]=Ae[Yt]=Ae[Zt]=Ae[te]=Ae[re]=Ae[ne]=Ae[oe]=Ae[ie]=Ae[ye]=Ae[ve]=Ae[de]=Ae[_e]=!0,Ae[Kt]=Ae[Qt]=Ae[ue]=!1;var Se="object"==typeof n&&n&&n.Object===Object&&n,Oe="object"==typeof self&&self&&self.Object===Object&&self,xe=Se||Oe||Function("return this")(),ze="object"==typeof e&&e&&!e.nodeType&&e,Ee=ze&&"object"==typeof t&&t&&!t.nodeType&&t,Te=Ee&&Ee.exports===ze,Me=Te&&Se.process,Pe=function(){try{return Me&&Me.binding("util")}catch(t){}}(),Ce=Pe&&Pe.isTypedArray,$e=Array.prototype,Be=Function.prototype,Ie=Object.prototype,Le=xe["__core-js_shared__"],Fe=function(){var t=/[^.]+$/.exec(Le&&Le.keys&&Le.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),ke=Be.toString,Ue=Ie.hasOwnProperty,De=ke.call(Object),He=Ie.toString,Ne=RegExp("^"+ke.call(Ue).replace(be,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Re=Te?xe.Buffer:void 0,Ve=xe.Symbol,We=xe.Uint8Array,qe=y(Object.getPrototypeOf,Object),Ge=Object.create,Je=Ie.propertyIsEnumerable,Ke=$e.splice,Qe=Object.getOwnPropertySymbols,Xe=Re?Re.isBuffer:void 0,Ye=y(Object.keys,Object),Ze=Math.max,tr=dt(xe,"DataView"),er=dt(xe,"Map"),rr=dt(xe,"Promise"),nr=dt(xe,"Set"),or=dt(xe,"WeakMap"),ir=dt(Object,"create"),ur=zt(tr),cr=zt(er),ar=zt(rr),sr=zt(nr),fr=zt(or),lr=Ve?Ve.prototype:void 0,hr=lr?lr.valueOf:void 0;d.prototype.clear=_,d.prototype.delete=b,d.prototype.get=g,d.prototype.has=j,d.prototype.set=w,m.prototype.clear=A,m.prototype.delete=S,m.prototype.get=O,m.prototype.has=x,m.prototype.set=z,E.prototype.clear=T,E.prototype.delete=M,E.prototype.get=P,E.prototype.has=C,E.prototype.set=$,B.prototype.clear=I,B.prototype.delete=L,B.prototype.get=F,B.prototype.has=k,B.prototype.set=U;var pr=Qe?y(Qe,Object):Dt,yr=J;(tr&&yr(new tr(new ArrayBuffer(1)))!=ae||er&&yr(new er)!=Yt||rr&&yr(rr.resolve())!=ee||nr&&yr(new nr)!=ne||or&&yr(new or)!=ue)&&(yr=function(t){var e=He.call(t),r=e==te?t.constructor:void 0,n=r?zt(r):void 0;if(n)switch(n){case ur:return ae;case cr:return Yt;case ar:return ee;case sr:return ne;case fr:return ue}return e});var vr=Array.isArray,dr=Xe||Ht,_r=Ce?f(Ce):Q,br=et(function(t){return t.push(void 0,Ot),i(gr,void 0,t)}),gr=pt(function(t,e,r,n){Z(t,e,r,n)});t.exports=br}),i=function(t,e){return function(){return t.apply(e,arguments)}};r=function(){function t(t,e,r){this.el=t,this.children=e,this.opt=r,this.saveStyle=i(this.saveStyle,this),this.originalElement=this.el,this.el=this.el.cloneNode(!1)}return t.prototype.saveStyle=function(){if(this.el.hasAttribute("style"))return this.el.setAttribute(this.opt.originalStyle,this.el.getAttribute("style"))},t.prototype.serializeStyle=function(){var t,e,r,n,o;if(this.el.currentStyle)return this.el.setAttribute("style",this.el.currentStyle);for(o=getComputedStyle(this.el),n=[],t=0,e=o.length;t<e;t++)r=o[t],n.push(this.el.style[r]=o[r]);return n},t.prototype.update=function(){return this.saveStyle(),this.serializeStyle()},t.prototype.interweaveText=function(){var t,e,r,n,o,i,u,c,a,s,f;if(e=this.originalElement.textContent,!e)return this.children;for(s=[[],0],n=s[0],i=s[1],f=this.originalElement.children,r=o=0,u=f.length;o<u;r=++o)t=f[r],c=t.textContent,c&&(a=e.indexOf(c,i),a>0&&(n.push(e.substring(i,a)),i=a),n.push(this.children[r]),i+=c.length);return n.push(e.substring(i)),n},t.prototype.toString=function(){var t,e;return this.update(),e=this.el.tagName,t=[e],this.el.innerHTML=this.interweaveText().join(""),this.el.outerHTML},t}();var u,c,a=r,s=function(t,e){function r(){this.constructor=t}for(var n in e)f.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},f={}.hasOwnProperty;u=a,c=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.moveSrc=function(){if(this.el.hasAttribute("src"))return this.el.setAttribute(this.opt.originalSrc,this.el.getAttribute("src")),this.el.removeAttribute("src")},e.prototype.removeBody=function(){return this.el.hasAttribute("text")&&this.el.removeAttribute("text"),this.el.hasAttribute("textContent")&&this.el.removeAttribute("textContent"),this.el.innerHTML=""},e.prototype.toString=function(){return e.__super__.toString.call(this),this.moveSrc(),this.removeBody(),this.el.outerHTML},e}(u);var l,h,p,y,v,d=c;v=o,p=t,h=a,y=d,l=function(){function t(t){this.opt=null!=t?t:{},v(this.opt,{originalStyle:"data-originalStyle",originalSrc:"data-originalSrc"})}return t.prototype.elementSerializer=h,t.prototype.scriptSerializer=y,t.prototype.serialize=function(t){var e,r,n,o,i,u,c,a;for(o=t.tagName.toLowerCase()+"Serializer",e=null!=(c=this[o])?c:this.elementSerializer,n=[],a=t.children,i=0,u=a.length;i<u;i++)r=a[i],n.push(this.serialize(r));return p.all(n).then(function(r){return function(n){var o;return o=new e(t,n,r.opt),o.toString()}}(this))},t}();var _=l;return _});
